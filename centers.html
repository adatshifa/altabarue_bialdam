<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أماكن التبرع - أداة شفاء</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f0fdfa; color: #1f2937; }
        .center-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            border: 1px solid #e5e7eb; /* Add a subtle border */
        }
        .center-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
            border-color: #0d9488; /* Highlight with teal color on hover */
        }
        .card-image {
            transition: transform 0.3s ease;
        }
        .center-card:hover .card-image {
            transform: scale(1.05); /* Zoom effect on image */
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #0d9488;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-extrabold text-teal-600">أداة شفاء</a>
            <a href="index.html" class="text-gray-600 hover:text-teal-700 font-semibold flex items-center gap-2">
                <i class="fas fa-arrow-left"></i> العودة للرئيسية
            </a>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 py-12">
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 mb-4">أماكن التبرع بالدم</h1>
            <p class="text-lg text-gray-600">ابحث عن أقرب مركز للتبرع وساهم في إنقاذ حياة.</p>
        </div>

        <div id="loading-indicator" class="flex justify-center items-center py-20">
            <div class="loader"></div>
        </div>
        
        <div id="centers-grid" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            </div>
        
        <div id="no-centers-message" class="hidden text-center py-20 bg-white rounded-xl shadow-md">
            <i class="fas fa-hospital-user text-5xl text-gray-400 mb-4"></i>
            <p class="text-xl font-semibold text-gray-600">لا توجد مراكز متاحة حاليًا.</p>
            <p class="text-gray-500 mt-2">يمكنك المساعدة باقتراح مركز جديد من خلال صفحة الاقتراحات.</p>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBjGbfd-myjqLtqvdMp4b-h4LIaeZjfUto",
          authDomain: "altabarue-bialdam.firebaseapp.com",
          databaseURL: "https://altabarue-bialdam-default-rtdb.firebaseio.com",
          projectId: "altabarue-bialdam",
          storageBucket: "altabarue-bialdam.appspot.com",
          messagingSenderId: "1032387539358",
          appId: "1:1032387539358:web:229d33a9d5a0f522c9268f",
          measurementId: "G-GQ6M7F21PZ"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const centersGrid = document.getElementById('centers-grid');
        const loadingIndicator = document.getElementById('loading-indicator');
        const noCentersMessage = document.getElementById('no-centers-message');
        
        const escapeHTML = str => str ? str.replace(/[&<>"']/g, match => ({'&': '&amp;','<': '&lt;','>': '&gt;','"': '&quot;',"'": '&#39;'})[match]) : '';

        const listenToCenters = () => {
            const q = query(collection(db, 'donation_centers'), orderBy('name'));
            onSnapshot(q, (snapshot) => {
                loadingIndicator.classList.add('hidden');
                
                if (snapshot.empty) {
                    noCentersMessage.classList.remove('hidden');
                    centersGrid.classList.add('hidden');
                    return;
                }
                
                centersGrid.innerHTML = '';
                noCentersMessage.classList.add('hidden');
                centersGrid.classList.remove('hidden');

                snapshot.forEach(doc => {
                    const center = doc.data();
                    const card = document.createElement('div');
                    card.className = 'center-card bg-white rounded-xl shadow-lg overflow-hidden flex flex-col';
                    
                    const placeholderImage = 'https://via.placeholder.com/400x300.png?text=Hospital';
                    const locationButton = center.locationUrl
                        ? `<a href="${escapeHTML(center.locationUrl)}" target="_blank" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-4 rounded-lg transition flex items-center justify-center gap-2">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>عرض على الخريطة</span>
                           </a>`
                        : `<button class="w-full bg-gray-400 text-white font-bold py-3 px-4 rounded-lg cursor-not-allowed flex items-center justify-center gap-2">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>الموقع غير متوفر</span>
                           </button>`;

                    card.innerHTML = `
                        <div class="h-48 bg-gray-200 overflow-hidden">
                            <img src="${center.imageUrl || placeholderImage}" alt="صورة مركز ${escapeHTML(center.name)}" class="w-full h-full object-cover card-image">
                        </div>
                        <div class="p-5 flex flex-col flex-grow">
                            <h2 class="text-xl font-bold text-gray-900 mb-2">${escapeHTML(center.name)}</h2>
                            <p class="text-gray-500 mb-4 flex items-center gap-2">
                                <i class="fas fa-map-pin text-gray-400"></i>
                                <span>${escapeHTML(center.wilaya)}</span>
                            </p>
                            <div class="mt-auto pt-4 border-t border-gray-100">
                                ${locationButton}
                            </div>
                        </div>
                    `;
                    centersGrid.appendChild(card);
                });
            });
        };

        listenToCenters();
    </script>
</body>
</html>